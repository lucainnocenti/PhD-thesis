%!TEX root = ./Thesis.tex
\usepackage{breakcites}
\usepackage{amsmath,amssymb}
\usepackage{amsfonts}
\usepackage{mathtools}

\usepackage{blindtext} % Package to generate dummy text throughout this template 

%%%%%%%%%%%%%%%%%% FONT CHOICE %%%%%%%%%%%%%%%%%%%%%%

% \usepackage{unicode-math}
\usepackage[bold-style=ISO]{unicode-math}
\usepackage{parskip}
\defaultfontfeatures{Scale=MatchLowercase}
\setmainfont{TeX Gyre Pagella}[Scale = 1.0]

% \setmathfont{Pagella Math}
% \setmathfont{XITS Math}
\usepackage{bm}

% \renewcommand{\boldsymbol}{\symbf} % this is because unicode-math with the bold-style option wants you to use \symbf rather that \boldsymbol, for some reason

% \linespread{1.05} % Line spacing - Palatino needs more space between lines

%%%%%%%%%%%%%%%%%% END FONT CHOICE %%%%%%%%%%%%%%%%%%%%%%

\usepackage{xspace} % to avoid newcommand eating trailing space
\usepackage{etoolbox}
\usepackage{microtype} % Slightly tweak font spacing for aesthetics

\usepackage[english]{babel} % Language hyphenation and typographical rules

\usepackage[hmarginratio=1:1,top=32mm,columnsep=20pt]{geometry} % Document margins
\usepackage{marginnote}
\renewcommand*{\marginfont}{\color{blue}\itshape\footnotesize}
\usepackage{setspace} % provides \setstretch
\usepackage[small,labelfont=bf,up,textfont=it,up]{caption} % Custom captions under/above floats in tables or figures
\usepackage{subcaption}
\usepackage{booktabs} % Horizontal rules in tables
\usepackage{fullpage}

\usepackage{lettrine} % The lettrine is the first enlarged letter at the beginning of the text

\usepackage{enumitem} % Customized lists
\setlist[itemize]{noitemsep} % Make itemize lists more compact


\usepackage{acronym}
\newacro{AD}{Automatic Differentiation}
\newacro{DR}{Dimensionality Reduction}
\newacro{ML}{Machine Learning}
\newacro{NN}{Neural Network}
\newacro{PCA}{Principal Component Analysis}
\newacro{CNN}{Convolutional Neural Network}
\newacro{SGD}{Stochastic Gradient Descend}
\newacro{SVM}{Support Vector Machine}
\newacro{QFT}{Quantum Fourier Transform}
\newacro{QML}{Quantum Machine Learning}

\newacro{QW}{Quantum Walk}
\newacro{DTQW}{Discrete-Time Quantum Walk}
\newacro{CTQW}{Continuous-Time Quantum Walk}

\newacro{LG}{Laguerre-Gauss}
\newacro{CCD}{Charge Coupled Device}
\newacro{SLM}{Spatial Light Modulator}
\newacro{SAM}{Spin Angular Momentum}
\newacro{OAM}{Orbital Angular Momentum}
\newacro{QWP}{Quarter-Wave Plate}
\newacro{HWP}{Half-Wave Plate}
\newacro{VVB}{Vector Vortex Beam}
\newacro{PBS}{Polarising Beamsplitter}
\newacro{QP}{Q-Plate}
\newacro{SMF}{Single Mode Optical Fiber}
\newacro{APD}{Avalanche Photodiode}
\newacro{SCS}{Spin Coherent State}
\newacro{SPDC}{Spontaneous Parametric Down Conversion}
\newacro{PPKTP}{Periodically-Poled Potassium Titanyl Phosphate}

\usepackage{todonotes}

\usepackage{abstract} % Allows abstract customization
\renewcommand{\abstractnamefont}{\normalfont\bfseries} % Set the "Abstract" text to bold
\renewcommand{\abstracttextfont}{\normalfont\small\itshape} % Set the abstract itself to small italic text

% \usepackage{titlesec} % Allows customization of titles
% \renewcommand\thesection{\Roman{section}} % Roman numerals for the sections
% \renewcommand\thesubsection{\roman{subsection}} % roman numerals for subsections
% \titleformat{\section}[block]{\large\scshape\centering}{\thesection.}{1em}{} % Change the look of the section titles
% \titleformat{\subsection}[block]{\large}{\thesubsection.}{1em}{} % Change the look of the section titles

% \usepackage{fancyhdr} % Headers and footers
% \pagestyle{fancy} % All pages have headers and footers
% \fancyhead{} % Blank out the default header
% \fancyfoot{} % Blank out the default footer
% \fancyhead[C]{Running title $\bullet$ May 2016 $\bullet$ Vol. XXI, No. 1} % Custom header text
% \fancyfoot[RO,LE]{\thepage} % Custom footer text

\usepackage{titling} % Customizing the title section

\usepackage{physics}
\usepackage{siunitx}

\usepackage{csquotes}

\usepackage{easyReview}

\usepackage{graphicx}
\graphicspath{{./Figures/}{./Figures/gate-learning/}{./Figures/quantum-walks/}{./Figures/VVBs/}}
\usepackage{wrapfig}
% \usepackage{subfig}

\usepackage{placeins}  % provides \FloatBarrier

\usepackage{xcolor}
\usepackage{nameref}
\usepackage[colorlinks=true,citecolor=red]{hyperref}
\usepackage[nameinlink]{cleveref}
\crefname{appsec}{Appendix}{Appendices}

\usepackage{listings} % for code snippets
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
 
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\scriptsize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
} 
\lstset{style=mystyle}


\usepackage{tikz}

\usepackage{amsthm}
% \newtheorem{example}{Example}

\usepackage[many]{tcolorbox}
% \tcbuselibrary{theorems}
% \newtcbtheorem
%   [number within=section]% init options
%   {example}% name
%   {Example}% title
%   {%
%     breakable, enhanced,
%     colback=green!5,
%     colframe=green!35!black,
%     fonttitle=\bfseries,
%     title={Porco dio}
%   }% options
%   {example}% prefix
\newtcolorbox[
    auto counter,
    number within=section,
    crefname={example}{examples}
]{example}[1][]{
  enhanced,
  breakable,
%   colback=green!5,
%   colframe=green!35!black,
  fonttitle=\bfseries,
  title={Example \thetcbcounter},
  #1
}

\newtcolorbox[
    auto counter,
    number within=section,
    crefname={example}{examples}
]{examplebox}[2][]{
  enhanced,
  breakable,
  fonttitle=\bfseries,
  title={Example \thetcbcounter: #2},
  #1
}

\newtcolorbox[auto counter]{tbox}[2][]{%
	enhanced,% float*=t,
	colback=gray!5!white, colframe=gray!75!black,
	width=\textwidth,
	title={Box \thetcbcounter: #2}, #1
}


% \usepackage[
%     backend=biber,
%     style=alphabetic,
%     maxcitenames=1,
%     url=true,
%     doi=true,
%     sorting=ynt,
%     backref=true
% ]{biblatex}
% \DeclareNameAlias{author}{given-family}

\usepackage{breakcites}
\usepackage[
    backend=biber,
    style=authoryear,
    maxnames=1,
    url=false,
    doi=true,
    sortcites=true,
    sorting=ynt,
    backref=true,
    firstinits=false,
    uniquelist=false, % to suppress multiple author names being used
    uniquename=false,
    % nohashothers=true, nosortothers=true,
    natbib
]{biblatex}
\renewcommand{\cite}{\parencite}


\DeclareNameFormat{labelname}{%
  \ifcase\value{uniquename}%
    \usebibmacro{name:family}
      {\namepartfamily}
      {\namepartgiven}
      {\namepartprefix}
      {\namepartsuffix}%
  \or
    \ifuseprefix
      {\usebibmacro{name:given-family}
        {\namepartfamily}
        {\namepartgiveni}
        {\namepartprefix}
        {\namepartsuffixi}}
      {\usebibmacro{name:given-family}
        {\namepartfamily}
        {\namepartgiveni}
        {\namepartprefixi}
        {\namepartsuffixi}}%
  \or
    \usebibmacro{name:given-family}
      {\namepartfamily}
      {\namepartgiven}
      {\namepartprefix}
      {\namepartsuffix}%
  \fi}


% ---------------- START SECOND FIX


\ExecuteBibliographyOptions{maxcitenames=1}

\DeclareFieldFormat{citehyperref}{%
  \DeclareFieldAlias{bibhyperref}{noformat}% Avoid nested links
  \bibhyperref{#1}}

\DeclareFieldFormat{textcitehyperref}{%
  \DeclareFieldAlias{bibhyperref}{noformat}% Avoid nested links
  \bibhyperref{%
    #1%
    \ifbool{cbx:parens}
      {\bibcloseparen\global\boolfalse{cbx:parens}}
      {}}}

\savebibmacro{cite}
\savebibmacro{textcite}

\renewbibmacro*{cite}{%
  \printtext[citehyperref]{%
    \restorebibmacro{cite}%
    \usebibmacro{cite}}}

\renewbibmacro*{textcite}{%
  \ifboolexpr{
    ( not test {\iffieldundef{prenote}} and
      test {\ifnumequal{\value{citecount}}{1}} )
    or
    ( not test {\iffieldundef{postnote}} and
      test {\ifnumequal{\value{citecount}}{\value{citetotal}}} )
  }
    {\DeclareFieldAlias{textcitehyperref}{noformat}}
    {}%
  \printtext[textcitehyperref]{%
    \restorebibmacro{textcite}%
    \usebibmacro{textcite}}}

% ---------------- END SECOND FIX

\usepackage{xparse,xcoffins}

\ExplSyntaxOn
\NewCoffin\imagecoffin
\NewCoffin\labelcoffin

\keys_define:nn { miguel/label }
 {
  label   .tl_set:N = \l_miguel_label_tl,
  labelbox .bool_set:N = \l_miguel_label_box_bool,
  labelbox .default:n = true,
  fontsize .tl_set:N = \l_miguel_label_size_tl,
  fontsize .initial:n = \footnotesize,
  pos .choice:,
  pos/nw .code:n = \tl_set:Nn \l_miguel_label_pos_tl { left,up },
  pos/ne .code:n = \tl_set:Nn \l_miguel_label_pos_tl { right,up },
  pos/sw .code:n = \tl_set:Nn \l_miguel_label_pos_tl { left,down },
  pos/se .code:n = \tl_set:Nn \l_miguel_label_pos_tl { right,down },
  pos/n .code:n = \tl_set:Nn \l_miguel_label_pos_tl { hc,up },
  pos/w .code:n = \tl_set:Nn \l_miguel_label_pos_tl { left,vc },
  pos/s .code:n = \tl_set:Nn \l_miguel_label_pos_tl { hc,down },
  pos/e .code:n = \tl_set:Nn \l_miguel_label_pos_tl { right,vc },
  pos .initial:n = nw,
  unknown .code:n   = \clist_put_right:Nx \l_miguel_label_clist
                       { \l_keys_key_tl = \exp_not:n { #1 } }
 }
\clist_new:N \l_miguel_label_clist
\box_new:N \l_miguel_label_box
\box_new:N \l_miguel_label_image_box

\NewDocumentCommand{\xincludegraphics}{O{}m}
 {
  \group_begin:
  \tl_clear:N \l_miguel_label_tl
  \clist_clear:N \l_miguel_label_clist
  \keys_set:nn { miguel/label } { #1 }
  \tl_if_empty:NTF \l_miguel_label_tl
   {
    \miguel_includegraphics:Vn \l_miguel_label_clist { #2 }
   }
   {
    \SetHorizontalCoffin\imagecoffin
     {
      \miguel_includegraphics:Vn \l_miguel_label_clist { #2 }
     }
    \SetHorizontalCoffin\labelcoffin
     {
      \raisebox{\depth}
       {
        \bool_if:NTF \l_miguel_label_box_bool
         { \fcolorbox{white}{white}{\l_miguel_label_size_tl\l_miguel_label_tl} }
         { \l_miguel_label_size_tl\l_miguel_label_tl }
       }
     }
    \SetVerticalPole\imagecoffin{left}{3pt+\CoffinWidth\labelcoffin/2}
    \SetVerticalPole\imagecoffin{right}{\Width-3pt-\CoffinWidth\labelcoffin/2}
    \SetHorizontalPole\imagecoffin{up}{\Height-3pt-\CoffinHeight\labelcoffin/2}
    \SetHorizontalPole\imagecoffin{down}{3pt+\CoffinHeight\labelcoffin/2}
    \use:x{\JoinCoffins\imagecoffin[\l_miguel_label_pos_tl]\labelcoffin[vc,hc]} 
    \TypesetCoffin\imagecoffin
   }
   \group_end:
 }
\NewDocumentCommand{\setlabel}{m}
 {
  \keys_set:nn { miguel/label } { #1 }
 }

\cs_new_protected:Nn \miguel_includegraphics:nn
 {
  \includegraphics[#1]{#2}
 }
\cs_generate_variant:Nn \miguel_includegraphics:nn { V }

\ExplSyntaxOff

\addbibresource{Thesis.bib}

